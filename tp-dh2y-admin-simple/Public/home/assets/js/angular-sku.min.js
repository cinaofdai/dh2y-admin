! function() {
    angular.module("ui.angularSku", []).value("skuConfig", {
        splitStr: ";"
    }).factory("utilService", ["$log", "skuConfig", function(t, n) {
        var e = {},
            r = [];
        return {
            filter: function(t, n) {
                var e = [];
                return angular.forEach(t, function(t, r) {
                    n(t, r) && e.push(t)
                }), e
            },
            getIndex: function(t) {
                var n = -1;
                return angular.forEach(r, function(e, r) {
                    -1 === n && angular.forEach(e, function(e) {
                        t === e && (n = r)
                    })
                }), n
            },
            unique: function(t) {
                for (var n = [], e = {}, r = 0; r < t.length; r++) e[t[r]] || (n.push(t[r]), e[t[r]] = 1);
                return n
            },
            getSkuList: function(e) {
                var r = [];
                return e || t.error("input sku-data error!"), angular.forEach(e, function(t, e) {
                    r.push(e.split(n.splitStr))
                }), r
            },
            transpose: function(t) {
                var n = t.length ? t.length : 0,
                    e = t[0] instanceof Array ? t[0].length : 0;
                if (0 === e || 0 === n) return [];
                var r, i, u = [];
                for (r = 0; e > r; r++)
                    for (u[r] = [], i = 0; n > i; i++) u[r][i] = t[i][r];
                return u
            },
            getKeys: function(t) {
                for (var n = this.getSkuList(t), e = this.transpose(n), i = [], u = 0; u < e.length; u++) i[u] = this.unique(e[u]);
                return r = i
            },
            getNum: function(t, i) {
                var u, a, o, l, c = 0,
                    s = [];
                if (angular.isDefined(e[t])) return e[t];
                if (l = t.split(n.splitStr), l.length === r.length) return i[t] ? i[t].count : 0;
                for (u = 0; u < r.length; u++) {
                    for (a = 0; a < r[u].length && l.length > 0 && r[u][a] != l[0]; a++);
                    if (!(a < r[u].length && l.length > 0)) {
                        for (o = 0; o < r[u].length; o++) c += this.getNum(s.concat(r[u][o], l).join(n.splitStr), i);
                        break
                    }
                    s.push(l.shift())
                }
                return e[t] = c, c
            }
        }
    }]).directive("uiSku", ["$log", "skuConfig", "utilService", function(t, n, e) {
        return {
            restrict: "A",
            transclude: !0,
            scope: {
                splitStr: "@",
                initSku: "@",
                onOk: "&",
                skuData: "="
            },
            controller: ["$scope", "$element", "$attrs", function(t) {
                this.checkIn = function(n) {
                    t.initSelect(n)
                }
            }],
            link: function(r, i, u, a, o) {
                r.splitStr && (n.splitStr = r.splitStr), r.keyMap = {}, r.selected = [], r.keys = e.getKeys(r.skuData), angular.forEach(r.keys, function(t) {
                    angular.forEach(t, function(t) {
                        r.keyMap[t] = {
                            name: t,
                            selected: !1,
                            disabled: !1
                        }
                    })
                }), o(r, function(t) {
                    i.append(t)
                }), r.initSelect = function(e) {
                    var i = e.split(n.splitStr);
                    0 == i.length && t.error("input init-sku is undefiend!"), angular.forEach(i, function(t) {
                        r.onSelect(t)
                    })
                }, r.onSelect = function(t) {
                    var i = r.keyMap,
                        u = [];
                    i[t].disabled || (r.checkItem(t), u = e.filter(r.selected, function(t) {
                        return angular.isDefined(t)
                    }), r.onOk({
                        $event: e.getNum(u.join(n.splitStr), r.skuData)
                    }))
                }, r.checkItem = function(i) {
                    var u = r.keyMap,
                        a = [],
                        o = [],
                        l = e.getIndex(i);
                    return -1 === l ? (t.error("key is undefiend!"), void 0) : (r.selected[l] = r.selected[l] === i ? void 0 : i, angular.forEach(r.keys, function(t, c) {
                        angular.copy(r.selected, a), angular.forEach(t, function(t) {
                            c === l && (u[t].selected = i === t ? !u[t].selected : !1), c === l || u[t].selected || (a[c] = t, o = e.filter(a, function(t) {
                                return angular.isDefined(t)
                            }), u[t].disabled = e.getNum(o.join(n.splitStr), r.skuData) > 0 ? !1 : !0)
                        })
                    }), void 0)
                }, r.initSku && r.initSelect(r.initSku)
            }
        }
    }])
}();
